---
config:
  theme: default
  look: classic
---
sequenceDiagram
    autonumber
    actor User as Khách hàng
    participant View
    participant Ctrl as Controller
    participant DB as Database

    Note over User,DB: Đăng ký
    User->>View: Truy cập trang đăng ký
    View-->>User: Hiển thị form đăng ký

    User->>View: Nhập thông tin (name, email, password)
    View->>Ctrl: Gửi yêu cầu đăng ký
    Ctrl->>DB: Kiểm tra email đã tồn tại?

    alt Email chưa tồn tại
        Ctrl->>DB: Tạo tài khoản mới (chưa kích hoạt)
        Ctrl->>Ctrl: Tạo mã kích hoạt & gửi email
        Ctrl-->>View: "Kiểm tra email để kích hoạt"
        View-->>User: Thông báo thành công
    else Email đã tồn tại
        Ctrl-->>View: "Email đã được đăng ký"
        View-->>User: Hiển thị lỗi
    end

    Note over User,DB: Kích hoạt tài khoản
    User->>View: Nhấn link kích hoạt trong email
    View->>Ctrl: Gửi yêu cầu kích hoạt
    Ctrl->>DB: Tìm tài khoản theo mã kích hoạt

    alt Mã hợp lệ
        Ctrl->>DB: Kích hoạt tài khoản
        Ctrl-->>View: Chuyển đến trang đăng nhập
        View-->>User: "Kích hoạt thành công"
    else Mã không hợp lệ
        Ctrl-->>View: "Link không hợp lệ hoặc hết hạn"
        View-->>User: Hiển thị lỗi
    end